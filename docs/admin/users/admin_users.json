{
    "openapi": "3.0.3",
    "info": {
        "title": "PMII API - Admin Users Module",
        "description": "API Contract untuk modul Admin Users.\nSemua endpoint dalam modul ini **hanya dapat diakses oleh Admin**.\nMemerlukan autentikasi menggunakan Bearer Token JWT.",
        "version": "1.0.0",
        "contact": {
            "name": "PMII Development Team"
        }
    },
    "servers": [
        {
            "url": "/v1",
            "description": "API Version 1"
        }
    ],
    "tags": [
        {
            "name": "Admin Users",
            "description": "Manajemen user oleh Admin (CRUD)"
        }
    ],
    "security": [
        {
            "BearerAuth": []
        }
    ],
    "paths": {
        "/admin/users": {
            "get": {
                "tags": [
                    "Admin Users"
                ],
                "summary": "Get All Users",
                "description": "Mengambil daftar semua user dengan pagination.\n**Hanya dapat diakses oleh Admin.**",
                "operationId": "getAllUsers",
                "parameters": [
                    {
                        "name": "page",
                        "in": "query",
                        "description": "Nomor halaman (default: 1)",
                        "required": false,
                        "schema": {
                            "type": "integer",
                            "default": 1,
                            "minimum": 1,
                            "example": 1
                        }
                    },
                    {
                        "name": "limit",
                        "in": "query",
                        "description": "Jumlah item per halaman (default: 20)",
                        "required": false,
                        "schema": {
                            "type": "integer",
                            "default": 20,
                            "minimum": 1,
                            "maximum": 100,
                            "example": 20
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Berhasil mengambil data user",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "allOf": [
                                        {
                                            "$ref": "#/components/schemas/SuccessResponseWithPagination"
                                        },
                                        {
                                            "type": "object",
                                            "properties": {
                                                "data": {
                                                    "$ref": "#/components/schemas/UserListResponse"
                                                }
                                            }
                                        }
                                    ]
                                },
                                "example": {
                                    "meta": {
                                        "code": 200,
                                        "status": "success",
                                        "message": "Data user berhasil diambil",
                                        "pagination": {
                                            "page": 1,
                                            "limit": 20,
                                            "total": 100,
                                            "lastPage": 5
                                        }
                                    },
                                    "data": {
                                        "users": [
                                            {
                                                "id": 1,
                                                "fullName": "John Doe",
                                                "email": "john@example.com",
                                                "role": "admin",
                                                "status": "active",
                                                "photoUri": "https://example.com/photos/john.jpg"
                                            },
                                            {
                                                "id": 2,
                                                "fullName": "Jane Smith",
                                                "email": "jane@example.com",
                                                "role": "author",
                                                "status": "active",
                                                "photoUri": ""
                                            }
                                        ],
                                        "total": 2
                                    }
                                }
                            }
                        }
                    },
                    "401": {
                        "$ref": "#/components/responses/UnauthorizedError"
                    },
                    "403": {
                        "$ref": "#/components/responses/ForbiddenError"
                    },
                    "500": {
                        "$ref": "#/components/responses/InternalServerError"
                    }
                }
            },
            "post": {
                "tags": [
                    "Admin Users"
                ],
                "summary": "Create User",
                "description": "Membuat user baru di sistem.\n**Hanya dapat diakses oleh Admin.**\nMendukung upload foto profile menggunakan multipart/form-data.",
                "operationId": "createUser",
                "requestBody": {
                    "required": true,
                    "content": {
                        "multipart/form-data": {
                            "schema": {
                                "$ref": "#/components/schemas/CreateUserRequest"
                            }
                        },
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/CreateUserRequestJSON"
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "User berhasil dibuat",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "allOf": [
                                        {
                                            "$ref": "#/components/schemas/SuccessResponse"
                                        },
                                        {
                                            "type": "object",
                                            "properties": {
                                                "data": {
                                                    "$ref": "#/components/schemas/UserListItem"
                                                }
                                            }
                                        }
                                    ]
                                },
                                "example": {
                                    "meta": {
                                        "code": 201,
                                        "status": "success",
                                        "message": "User berhasil dibuat"
                                    },
                                    "data": {
                                        "id": 3,
                                        "fullName": "New User",
                                        "email": "newuser@example.com",
                                        "role": "author",
                                        "status": "active",
                                        "photoUri": "https://example.com/photos/newuser.jpg"
                                    }
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request - Validasi gagal",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ValidationErrorResponse"
                                },
                                "examples": {
                                    "validation_error": {
                                        "summary": "Validation Error",
                                        "value": {
                                            "meta": {
                                                "code": 400,
                                                "status": "error",
                                                "message": "Validasi gagal"
                                            },
                                            "errors": "Key: 'CreateUserRequest.Email' Error:Field validation for 'Email' failed on the 'email' tag"
                                        }
                                    },
                                    "email_exists": {
                                        "summary": "Email Already Exists",
                                        "value": {
                                            "meta": {
                                                "code": 400,
                                                "status": "error",
                                                "message": "Email sudah digunakan"
                                            },
                                            "data": null
                                        }
                                    },
                                    "invalid_password": {
                                        "summary": "Invalid Password",
                                        "value": {
                                            "meta": {
                                                "code": 400,
                                                "status": "error",
                                                "message": "Password tidak valid"
                                            },
                                            "data": null
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "401": {
                        "$ref": "#/components/responses/UnauthorizedError"
                    },
                    "403": {
                        "$ref": "#/components/responses/ForbiddenError"
                    },
                    "500": {
                        "$ref": "#/components/responses/InternalServerError"
                    }
                }
            }
        },
        "/admin/users/{id}": {
            "get": {
                "tags": [
                    "Admin Users"
                ],
                "summary": "Get User by ID",
                "description": "Mengambil detail user berdasarkan ID.\n**Hanya dapat diakses oleh Admin.**",
                "operationId": "getUserById",
                "parameters": [
                    {
                        "$ref": "#/components/parameters/UserIdPath"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Berhasil mengambil profil user",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "allOf": [
                                        {
                                            "$ref": "#/components/schemas/SuccessResponse"
                                        },
                                        {
                                            "type": "object",
                                            "properties": {
                                                "data": {
                                                    "$ref": "#/components/schemas/UserListItem"
                                                }
                                            }
                                        }
                                    ]
                                },
                                "example": {
                                    "meta": {
                                        "code": 200,
                                        "status": "success",
                                        "message": "Profil berhasil diambil"
                                    },
                                    "data": {
                                        "id": 1,
                                        "fullName": "John Doe",
                                        "email": "john@example.com",
                                        "role": "admin",
                                        "status": "active",
                                        "photoUri": "https://example.com/photos/john.jpg"
                                    }
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "ID tidak valid",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                },
                                "example": {
                                    "meta": {
                                        "code": 400,
                                        "status": "error",
                                        "message": "ID tidak valid"
                                    },
                                    "data": null
                                }
                            }
                        }
                    },
                    "401": {
                        "$ref": "#/components/responses/UnauthorizedError"
                    },
                    "403": {
                        "$ref": "#/components/responses/ForbiddenError"
                    },
                    "404": {
                        "$ref": "#/components/responses/NotFoundError"
                    },
                    "500": {
                        "$ref": "#/components/responses/InternalServerError"
                    }
                }
            },
            "put": {
                "tags": [
                    "Admin Users"
                ],
                "summary": "Update User by ID",
                "description": "Mengupdate data user berdasarkan ID.\n**Hanya dapat diakses oleh Admin.**\nSemua field bersifat opsional - hanya field yang disertakan yang akan di-update.\nMendukung upload foto profile menggunakan multipart/form-data.",
                "operationId": "updateUserById",
                "parameters": [
                    {
                        "$ref": "#/components/parameters/UserIdPath"
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "multipart/form-data": {
                            "schema": {
                                "$ref": "#/components/schemas/UpdateUserRequest"
                            }
                        },
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/UpdateUserRequestJSON"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "User berhasil diupdate",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "allOf": [
                                        {
                                            "$ref": "#/components/schemas/SuccessResponse"
                                        },
                                        {
                                            "type": "object",
                                            "properties": {
                                                "data": {
                                                    "$ref": "#/components/schemas/UserListItem"
                                                }
                                            }
                                        }
                                    ]
                                },
                                "example": {
                                    "meta": {
                                        "code": 200,
                                        "status": "success",
                                        "message": "User berhasil diupdate"
                                    },
                                    "data": {
                                        "id": 1,
                                        "fullName": "John Doe Updated",
                                        "email": "john.updated@example.com",
                                        "role": "admin",
                                        "status": "active",
                                        "photoUri": "https://example.com/photos/john-new.jpg"
                                    }
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request - Validasi gagal",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ValidationErrorResponse"
                                },
                                "examples": {
                                    "invalid_id": {
                                        "summary": "Invalid ID",
                                        "value": {
                                            "meta": {
                                                "code": 400,
                                                "status": "error",
                                                "message": "ID tidak valid"
                                            },
                                            "data": null
                                        }
                                    },
                                    "email_used": {
                                        "summary": "Email Already Used",
                                        "value": {
                                            "meta": {
                                                "code": 400,
                                                "status": "error",
                                                "message": "Email sudah digunakan user lain"
                                            },
                                            "data": null
                                        }
                                    },
                                    "invalid_password": {
                                        "summary": "Invalid Password",
                                        "value": {
                                            "meta": {
                                                "code": 400,
                                                "status": "error",
                                                "message": "Password tidak valid"
                                            },
                                            "data": null
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "401": {
                        "$ref": "#/components/responses/UnauthorizedError"
                    },
                    "403": {
                        "$ref": "#/components/responses/ForbiddenError"
                    },
                    "404": {
                        "$ref": "#/components/responses/NotFoundError"
                    },
                    "500": {
                        "$ref": "#/components/responses/InternalServerError"
                    }
                }
            },
            "delete": {
                "tags": [
                    "Admin Users"
                ],
                "summary": "Delete User by ID",
                "description": "Menghapus user berdasarkan ID (soft delete).\n**Hanya dapat diakses oleh Admin.**",
                "operationId": "deleteUserById",
                "parameters": [
                    {
                        "$ref": "#/components/parameters/UserIdPath"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "User berhasil dihapus",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/SuccessResponse"
                                },
                                "example": {
                                    "meta": {
                                        "code": 200,
                                        "status": "success",
                                        "message": "User berhasil dihapus"
                                    },
                                    "data": null
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "ID tidak valid",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                },
                                "example": {
                                    "meta": {
                                        "code": 400,
                                        "status": "error",
                                        "message": "ID tidak valid"
                                    },
                                    "data": null
                                }
                            }
                        }
                    },
                    "401": {
                        "$ref": "#/components/responses/UnauthorizedError"
                    },
                    "403": {
                        "$ref": "#/components/responses/ForbiddenError"
                    },
                    "404": {
                        "$ref": "#/components/responses/NotFoundError"
                    },
                    "500": {
                        "$ref": "#/components/responses/InternalServerError"
                    }
                }
            }
        }
    },
    "components": {
        "securitySchemes": {
            "BearerAuth": {
                "type": "http",
                "scheme": "bearer",
                "bearerFormat": "JWT",
                "description": "JWT Token dari endpoint login. Format header: `Authorization: Bearer <token>`"
            }
        },
        "parameters": {
            "UserIdPath": {
                "name": "id",
                "in": "path",
                "description": "ID unik user",
                "required": true,
                "schema": {
                    "type": "integer",
                    "minimum": 1,
                    "example": 1
                }
            }
        },
        "schemas": {
            "BaseUserRequest": {
                "type": "object",
                "required": [
                    "full_name",
                    "email",
                    "password"
                ],
                "properties": {
                    "full_name": {
                        "type": "string",
                        "minLength": 2,
                        "maxLength": 100,
                        "description": "Nama lengkap user",
                        "example": "John Doe"
                    },
                    "email": {
                        "type": "string",
                        "format": "email",
                        "description": "Email user (harus unik)",
                        "example": "john@example.com"
                    },
                    "password": {
                        "type": "string",
                        "format": "password",
                        "minLength": 8,
                        "description": "Password user (minimal 8 karakter)",
                        "example": "password123"
                    }
                }
            },
            "CreateUserRequest": {
                "allOf": [
                    {
                        "$ref": "#/components/schemas/BaseUserRequest"
                    },
                    {
                        "type": "object",
                        "properties": {
                            "photo": {
                                "type": "string",
                                "format": "binary",
                                "description": "Foto profil user (maksimal 5MB)"
                            }
                        }
                    }
                ]
            },
            "CreateUserRequestJSON": {
                "$ref": "#/components/schemas/BaseUserRequest"
            },
            "UpdateUserRequestBase": {
                "type": "object",
                "properties": {
                    "full_name": {
                        "type": "string",
                        "minLength": 2,
                        "maxLength": 100,
                        "description": "Nama lengkap user",
                        "example": "John Doe Updated"
                    },
                    "email": {
                        "type": "string",
                        "format": "email",
                        "description": "Email user (harus unik)",
                        "example": "john.updated@example.com"
                    },
                    "password": {
                        "type": "string",
                        "format": "password",
                        "minLength": 8,
                        "description": "Password baru user (minimal 8 karakter)",
                        "example": "newpassword123"
                    },
                    "role": {
                        "type": "integer",
                        "enum": [
                            1,
                            2
                        ],
                        "description": "Role user: 1 = Admin, 2 = Author",
                        "example": 2
                    },
                    "is_active": {
                        "type": "boolean",
                        "description": "Status aktif user",
                        "example": true
                    }
                }
            },
            "UpdateUserRequest": {
                "allOf": [
                    {
                        "$ref": "#/components/schemas/UpdateUserRequestBase"
                    },
                    {
                        "type": "object",
                        "properties": {
                            "photo": {
                                "type": "string",
                                "format": "binary",
                                "description": "Foto profil user (maksimal 5MB)"
                            }
                        }
                    }
                ]
            },
            "UpdateUserRequestJSON": {
                "$ref": "#/components/schemas/UpdateUserRequestBase"
            },
            "Meta": {
                "type": "object",
                "properties": {
                    "code": {
                        "type": "integer",
                        "description": "HTTP status code",
                        "example": 200
                    },
                    "status": {
                        "type": "string",
                        "enum": [
                            "success",
                            "error"
                        ],
                        "description": "Status response",
                        "example": "success"
                    },
                    "message": {
                        "type": "string",
                        "description": "Pesan response",
                        "example": "Data berhasil diambil"
                    }
                }
            },
            "Pagination": {
                "type": "object",
                "properties": {
                    "page": {
                        "type": "integer",
                        "description": "Halaman saat ini",
                        "example": 1
                    },
                    "limit": {
                        "type": "integer",
                        "description": "Jumlah item per halaman",
                        "example": 20
                    },
                    "total": {
                        "type": "integer",
                        "format": "int64",
                        "description": "Total semua item",
                        "example": 100
                    },
                    "lastPage": {
                        "type": "integer",
                        "description": "Halaman terakhir",
                        "example": 5
                    }
                }
            },
            "SuccessResponse": {
                "type": "object",
                "properties": {
                    "meta": {
                        "$ref": "#/components/schemas/Meta"
                    },
                    "data": {
                        "type": "object",
                        "nullable": true
                    }
                }
            },
            "SuccessResponseWithPagination": {
                "type": "object",
                "properties": {
                    "meta": {
                        "allOf": [
                            {
                                "$ref": "#/components/schemas/Meta"
                            },
                            {
                                "type": "object",
                                "properties": {
                                    "pagination": {
                                        "$ref": "#/components/schemas/Pagination"
                                    }
                                }
                            }
                        ]
                    },
                    "data": {
                        "type": "object"
                    }
                }
            },
            "ErrorResponse": {
                "type": "object",
                "properties": {
                    "meta": {
                        "$ref": "#/components/schemas/Meta"
                    },
                    "data": {
                        "type": "object",
                        "nullable": true,
                        "example": null
                    }
                }
            },
            "ValidationErrorResponse": {
                "type": "object",
                "properties": {
                    "meta": {
                        "$ref": "#/components/schemas/Meta"
                    },
                    "errors": {
                        "type": "string",
                        "description": "Detail error validasi"
                    }
                }
            },
            "UserListItem": {
                "type": "object",
                "properties": {
                    "id": {
                        "type": "integer",
                        "description": "ID user",
                        "example": 1
                    },
                    "fullName": {
                        "type": "string",
                        "description": "Nama lengkap user",
                        "example": "John Doe"
                    },
                    "email": {
                        "type": "string",
                        "format": "email",
                        "description": "Email user",
                        "example": "john@example.com"
                    },
                    "role": {
                        "type": "string",
                        "enum": [
                            "admin",
                            "author"
                        ],
                        "description": "Role user",
                        "example": "admin"
                    },
                    "status": {
                        "type": "string",
                        "enum": [
                            "active",
                            "inactive"
                        ],
                        "description": "Status user",
                        "example": "active"
                    },
                    "photoUri": {
                        "type": "string",
                        "description": "URL foto profil user",
                        "example": "https://example.com/photos/john.jpg"
                    }
                }
            },
            "UserListResponse": {
                "type": "object",
                "properties": {
                    "users": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/UserListItem"
                        }
                    },
                    "total": {
                        "type": "integer",
                        "description": "Total user dalam response",
                        "example": 10
                    }
                }
            }
        },
        "responses": {
            "UnauthorizedError": {
                "description": "Unauthorized - Token tidak valid atau tidak ada",
                "content": {
                    "application/json": {
                        "schema": {
                            "$ref": "#/components/schemas/ErrorResponse"
                        },
                        "example": {
                            "meta": {
                                "code": 401,
                                "status": "error",
                                "message": "Akses ditolak - Token tidak valid"
                            },
                            "data": null
                        }
                    }
                }
            },
            "ForbiddenError": {
                "description": "Forbidden - Tidak memiliki akses ke resource ini",
                "content": {
                    "application/json": {
                        "schema": {
                            "$ref": "#/components/schemas/ErrorResponse"
                        },
                        "example": {
                            "meta": {
                                "code": 403,
                                "status": "error",
                                "message": "Akses ditolak - Hanya admin yang dapat mengakses"
                            },
                            "data": null
                        }
                    }
                }
            },
            "NotFoundError": {
                "description": "Not Found - Resource tidak ditemukan",
                "content": {
                    "application/json": {
                        "schema": {
                            "$ref": "#/components/schemas/ErrorResponse"
                        },
                        "example": {
                            "meta": {
                                "code": 404,
                                "status": "error",
                                "message": "User tidak ditemukan"
                            },
                            "data": null
                        }
                    }
                }
            },
            "InternalServerError": {
                "description": "Internal Server Error",
                "content": {
                    "application/json": {
                        "schema": {
                            "$ref": "#/components/schemas/ErrorResponse"
                        },
                        "example": {
                            "meta": {
                                "code": 500,
                                "status": "error",
                                "message": "Terjadi kesalahan server"
                            },
                            "data": null
                        }
                    }
                }
            }
        }
    }
}